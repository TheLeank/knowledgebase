"use strict";(self.webpackChunkkb=self.webpackChunkkb||[]).push([[914],{3905:function(e,r,a){a.d(r,{Zo:function(){return p},kt:function(){return m}});var t=a(7294);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?o(Object(a),!0).forEach((function(r){n(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function i(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=t.createContext({}),s=function(e){var r=t.useContext(c),a=r;return e&&(a="function"==typeof e?e(r):l(l({},r),e)),a},p=function(e){var r=s(e.components);return t.createElement(c.Provider,{value:r},e.children)},d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},u=t.forwardRef((function(e,r){var a=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=s(a),m=n,h=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return a?t.createElement(h,l(l({ref:r},p),{},{components:a})):t.createElement(h,l({ref:r},p))}));function m(e,r){var a=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=u;var i={};for(var c in r)hasOwnProperty.call(r,c)&&(i[c]=r[c]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var s=2;s<o;s++)l[s]=a[s];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},1009:function(e,r,a){a.r(r),a.d(r,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return p},default:function(){return u}});var t=a(7462),n=a(3366),o=(a(7294),a(3905)),l=["components"],i={title:"Plesk"},c=void 0,s={unversionedId:"plesk",id:"plesk",isDocsHomePage:!1,title:"Plesk",description:"Ver origen de spam (Qmail)",source:"@site/docs/plesk.md",sourceDirName:".",slug:"/plesk",permalink:"/plesk",editUrl:"https://github.com/TheLeank/knowledgebase/edit/master/docs/plesk.md",version:"current",frontMatter:{title:"Plesk"},sidebar:"someSidebar",previous:{title:"PHP",permalink:"/php"},next:{title:"WHM & cPanel",permalink:"/whm"}},p=[{value:"Ver origen de spam (Qmail)",id:"ver-origen-de-spam-qmail",children:[]},{value:"Purgar cola de correo (Qmail y Postfix)",id:"purgar-cola-de-correo-qmail-y-postfix",children:[]},{value:"Establecer duraci\xf3n en cola de correo",id:"establecer-duraci\xf3n-en-cola-de-correo",children:[]},{value:"Gestionar cuentas de correo",id:"gestionar-cuentas-de-correo",children:[{value:"Crear cuenta",id:"crear-cuenta",children:[]},{value:"Eliminar cuenta",id:"eliminar-cuenta",children:[]}]},{value:"Shell root usando admin y crontab",id:"shell-root-usando-admin-y-crontab",children:[]},{value:"Reconfigurar vhost",id:"reconfigurar-vhost",children:[]},{value:"Listar int\xe9rpretes de php",id:"listar-int\xe9rpretes-de-php",children:[]},{value:"Comprobar estado de la cola de correo(Qmail)",id:"comprobar-estado-de-la-cola-de-correoqmail",children:[]},{value:"Forzar cola de correo",id:"forzar-cola-de-correo",children:[]},{value:"Cambiar HELO (Qmail)",id:"cambiar-helo-qmail",children:[]},{value:"Reparar correos",id:"reparar-correos",children:[]}],d={toc:p};function u(e){var r=e.components,a=(0,n.Z)(e,l);return(0,o.kt)("wrapper",(0,t.Z)({},d,a,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"ver-origen-de-spam-qmail"},"Ver origen de spam (Qmail)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd /var/qmail/queue/mess/22/\nls -lt | more\n")),(0,o.kt)("p",null,"Copiar la direcci\xf3n IP de uno de los resultados obtenidos por la anterior consulta."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cat /usr/local/psa/var/log/maillog | grep IP\n")),(0,o.kt)("p",null,"Sacar el usuario autenticado que mas correos ha enviado"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cat /usr/local/psa/var/log/maillog |grep -I smtp_auth |grep -I user |awk '{print $11}' |sort |uniq -c |sort -n\n")),(0,o.kt)("h2",{id:"purgar-cola-de-correo-qmail-y-postfix"},"Purgar cola de correo (Qmail y Postfix)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/admin/sbin/mailmng --stop-service\nfind /var/qmail/queue/mess -type f -exec rm {} \\;\nfind /var/qmail/queue/info -type f -exec rm {} \\;\nfind /var/qmail/queue/local -type f -exec rm {} \\;\nfind /var/qmail/queue/intd -type f -exec rm {} \\;\nfind /var/qmail/queue/todo -type f -exec rm {} \\;\nfind /var/qmail/queue/remote -type f -exec rm {} \\;\n/usr/local/psa/admin/sbin/mailmng --start-service\n")),(0,o.kt)("h2",{id:"establecer-duraci\xf3n-en-cola-de-correo"},"Establecer duraci\xf3n en cola de correo"),(0,o.kt)("p",null,"Se indica en n\xfamero de segundos. El siguiente ejemplo limita la vida del correo a 1 hora en la cola."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"echo '3600' > /var/qmail/control/queuelifetime && /etc/init.d/qmail restart\n")),(0,o.kt)("h2",{id:"gestionar-cuentas-de-correo"},"Gestionar cuentas de correo"),(0,o.kt)("h3",{id:"crear-cuenta"},"Crear cuenta"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/bin/mail --create 'CUENTA' -passwd 'PASS' -mailbox true\n")),(0,o.kt)("h3",{id:"eliminar-cuenta"},"Eliminar cuenta"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/bin/mail --remove 'CUENTA'\n")),(0,o.kt)("h2",{id:"shell-root-usando-admin-y-crontab"},"Shell root usando admin y crontab"),(0,o.kt)("p",null,"Crear el fichero sshd_config manualmente, de manera que lo podamos borrar posteriormente sin necesidad de otra tarea programada."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cat /etc/ssh/sshd_config > /var/www/vhosts/SITIO/httpdocs/sshd_config\n")),(0,o.kt)("p",null,"Editar el fichero con la configuraci\xf3n deseada."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cat /var/www/vhosts/SITIO/httpdocs/sshd_config > /etc/ssh/sshd_config\n")),(0,o.kt)("p",null,"Crear un script para modificar la contrase\xf1a del usuario root"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-none",metastring:'title="/var/www/vhosts/SITIO/httpdocs/script.sh"',title:'"/var/www/vhosts/SITIO/httpdocs/script.sh"'},'echo "root:PASS" | /usr/sbin/chpasswd \n')),(0,o.kt)("p",null,"Por \xfaltimo, reiniciar el servicio"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/etc/init.d/ssh restart\n")),(0,o.kt)("h2",{id:"reconfigurar-vhost"},"Reconfigurar vhost"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/admin/sbin/httpdmng --reconfigure-domain DOMINIO\n")),(0,o.kt)("p",null,"Tambi\xe9n puedes reconfigurar todos los vhosts del servidor"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/admin/sbin/httpdmng --reconfigure-all\n")),(0,o.kt)("p",null,"Restaurar permisos"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/bin/repair --restore-vhosts-permissions\n")),(0,o.kt)("h2",{id:"listar-int\xe9rpretes-de-php"},"Listar int\xe9rpretes de php"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/bin/php_handler --list\n")),(0,o.kt)("h2",{id:"comprobar-estado-de-la-cola-de-correoqmail"},"Comprobar estado de la cola de correo(Qmail)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/var/qmail/bin/qmail-qstat\n")),(0,o.kt)("h2",{id:"forzar-cola-de-correo"},"Forzar cola de correo"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/admin/bin/mailqueuemng -a\n")),(0,o.kt)("h2",{id:"cambiar-helo-qmail"},"Cambiar HELO (Qmail)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"echo mail.domain.tld > /var/qmail/control/me\n")),(0,o.kt)("h2",{id:"reparar-correos"},"Reparar correos"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/usr/local/psa/admin/sbin/mchk --with-spam\n")))}u.isMDXComponent=!0}}]);